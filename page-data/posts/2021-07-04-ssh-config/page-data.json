{"componentChunkName":"component---src-templates-post-js","path":"/posts/2021-07-04-ssh-config/","result":{"data":{"site":{"siteMetadata":{"title":"MJUN Tech Note","author":"Junya Morioka"}},"markdownRemark":{"id":"3ada1ccd-c251-5851-abf0-f5a1a59227ed","html":"<h2 id=\"まずは基本系\">まずは基本系</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> username@<span class=\"token punctuation\">{</span>hostname or ip<span class=\"token punctuation\">}</span></code></pre></div>\n<p>デフォルトではポート22に接続される。usernameは省略できる。省略した場合は現在のPCのusernameで接続される。</p>\n<h2 id=\"sshconfig\">~/.ssh/config</h2>\n<p>Unix, Linuxではuserのホームディレクトリの<code class=\"language-text\">.ssh/</code>以下に秘密鍵やconfigを保存する。\n.sshディレクトリは700、.ssh以下のファイルには600の権限を付与する。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token output\">~/.ssh/\n├── authorized_keys\n├── config\n├── id_rsa\n├── id_rsa.pub\n├── known_hosts\n├── known_hosts-e</span></code></pre></div>\n<p>ssh接続を楽にするためにconfigファイルに予め接続設定を書いておく。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token output\">Host hoge\n  HostName 192.168.0.0\n  User hoge\n  Port 22\n  IdentifyFile ~/.ssh/id_rsa</span></code></pre></div>\n<p>上記の設定を<code class=\"language-text\">~/.ssh/config</code>に書いておくと<code class=\"language-text\">ssh hoge</code>のみで接続することが可能になる。</p>\n<h2 id=\"多段ssh\">多段ssh</h2>\n<p>セキュリティ上の理由で。接続したい端末に直接接続出来ない場合がある。\n例えば、接続したい端末へローカルネットワークでしか接続できず、プロキシーサーバ(接続したい端末と同じネットワーク内にあり、外からアクセスできる。)を介して接続する場合が考えられる。\nこの場合、Client -> Proxy -> Targetというようにssh接続を重ねて接続しなければならない。これをsshコマンド1行またはssh configで行う方法について説明する。</p>\n<p>まずはsshコマンド</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">ProxyCommand</span><span class=\"token operator\">=</span><span class=\"token string\">'ssh -W %h:%p Proxy'</span> Target</code></pre></div>\n<p><code class=\"language-text\">-o</code>はssh の設定を指定できるオプションで、ssh configよりも優先される。</p>\n<p>続いてssh configでの設定。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token output\">Host proxy\n    User hoge\n\nHost target\n    User fuga\n    ProxyCommand  ssh -W %h:%p proxy</span></code></pre></div>\n<p>上記の設定をした上で<code class=\"language-text\">ssh target</code>をすれば踏み台の先のサーバに接続できる。</p>\n<h2 id=\"sshコマンドのオプションとssh-configの対応\">sshコマンドのオプションとssh configの対応</h2>\n<table>\n<thead>\n<tr>\n<th>command</th>\n<th>config</th>\n<th>説明</th>\n<th>例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>-p</td>\n<td>Port</td>\n<td>接続先のPortの指定</td>\n<td>ssh -p 22</td>\n</tr>\n<tr>\n<td>-i</td>\n<td>IdentifyFile</td>\n<td>接続に使用する秘密鍵のPath</td>\n<td>ssh -i ~/.ssh/hoge_rsa</td>\n</tr>\n<tr>\n<td>-X</td>\n<td>ForwardX11</td>\n<td>Xwindowを転送するかどうか。</td>\n<td>ForwardX11 yes</td>\n</tr>\n<tr>\n<td>-Y</td>\n<td>ForwardX11Trusted</td>\n<td>信頼されたXwindowの転送。macOSでXquartzを使うときはこれ。</td>\n<td>ForwardX11Trusted yes</td>\n</tr>\n<tr>\n<td>-L</td>\n<td>LocalForward</td>\n<td>クライアントのポートをリモートのネットワーク内のPCに飛ばす</td>\n<td>ssh -L 8080:remote_pc:80</td>\n</tr>\n<tr>\n<td>-o StrictHostKeyChecking=</td>\n<td>StrictHostKeyChecking</td>\n<td>known_hostの扱いを決める。</td>\n<td>yes(接続しない)、no(接続する)、ask(default 確認させる)</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"macosに使える設定\">macOSに使える設定</h3>\n<ul>\n<li>AddKeysToAgent</li>\n<li>UseKeychain</li>\n</ul>\n<p>ssh agentに鍵を登録する。再起動時にも有効。</p>","tableOfContents":"<ul>\n<li><a href=\"#%E3%81%BE%E3%81%9A%E3%81%AF%E5%9F%BA%E6%9C%AC%E7%B3%BB\">まずは基本系</a></li>\n<li><a href=\"#sshconfig\">~/.ssh/config</a></li>\n<li><a href=\"#%E5%A4%9A%E6%AE%B5ssh\">多段ssh</a></li>\n<li><a href=\"#ssh%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A8ssh-config%E3%81%AE%E5%AF%BE%E5%BF%9C\">sshコマンドのオプションとssh configの対応</a></li>\n</ul>","excerpt":"まずは基本系 デフォルトではポート22に接続される。usernameは省略できる。省略した場合は現在のPCのusernameで接続される。 ~/.ssh/config Unix, Linuxではuserのホームディレクトリの以下に秘密鍵やconfigを保存する。\n.ssh…","frontmatter":{"title":"SSHのOption, Configまわりの設定","date":"2021.07.04","update":"2021.07.04","category":"Linux","tags":["Linux"]},"fields":{"slug":"/posts/2021-07-04-ssh-config/"}}},"pageContext":{"id":"3ada1ccd-c251-5851-abf0-f5a1a59227ed"}},"staticQueryHashes":["1123391092"],"slicesMap":{}}