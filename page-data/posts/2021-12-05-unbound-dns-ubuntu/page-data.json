{"componentChunkName":"component---src-templates-post-js","path":"/posts/2021-12-05-unbound-dns-ubuntu/","result":{"data":{"site":{"siteMetadata":{"title":"MJUN Tech Note","author":"Junya Morioka"}},"markdownRemark":{"id":"62d8fa19-e264-5415-aba9-05499a16bcd9","html":"<p>本ページでは，自宅ネットワーク内にDNSサーバを立ち上げる方法についてメモを書く．<br>\n今回はunboundを使って構築する．</p>\n<h2 id=\"自宅dnsサーバを立てる理由\">自宅DNSサーバを立てる理由</h2>\n<p>自宅に内向きDNSサーバを立てるメリットは以下があげられる．</p>\n<ol>\n<li>プロバイダーの提供するDNSサーバに影響を受けない</li>\n<li>ドメインを付与した外部公開しているサーバがある場合，自宅ネットワーク内からでもドメインで名前解決できる．</li>\n<li>好きな名前で自宅内のホストに名前解決できる</li>\n</ol>\n<p>1について，大抵はプロバイダーのDNSを使っていると考えられる．\nこのDNSを変更したい場合は自分で立てるメリットがある．\nデバイスごとに変更することもできるが，ネットワーク内の全デバイスに対して適用したい場合は，大本のDNS参照先を変えてしまったほうが早い．</p>\n<p>2について，自宅のグローバルIPにドメインを振っている場合，外部からドメイン名で名前解決して自宅内サーバにアクセスすることはできる．(というかそのためにドメイン振ってる)<br>\nしかし，アクセスしたいサーバと同じネットワークにいる場合，ドメイン名でアクセスができない．(これをうまく解決してくれるルーターもあるらしい．)\nこれを解決する方法は，デバイスのhostsファイルに書き込むなどの方法があるが，新しいデバイスが来るたびにこれをやっているときりがないので，自分でDNSサーバを立てると楽できる．</p>\n<p>3についてはおまけで，sshならconfigで好きな名前にできるし，<code class=\"language-text\">.local</code>がついてしまうが，avahiを利用してmDNSを使うこともできる．</p>\n<p>まとめると，自宅DNSサーバを立てるは，「一括で」ネットワーク内の名前解決を設定できるという点が大きい．</p>\n<h2 id=\"技術選定\">技術選定</h2>\n<p>DNSサーバを立てる方法はいくつかあって，一番有名なのはbindだと思う．<br>\n脆弱性が多いというデメリットが散見されるが，自宅内だけで利用し，外部に公開しないのであればそこまで気にしなくても大丈夫だと考えられる．</p>\n<p>しかし，自宅内だけで使うには機能が過剰で，設定ファイルも冗長なので，今回は設定ファイルが簡素なunboundを選定した．</p>\n<h2 id=\"install\">install</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> unbound</code></pre></div>\n<p>設定ファイル例は以下．</p>\n<p><code class=\"language-text\">/etc/unbound/unbound.conf.d/</code>に設定ファイルを置く．</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">chroot</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token key atrule\">verbosity</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">interface</span><span class=\"token punctuation\">:</span> 127.0.0.0\n  <span class=\"token key atrule\">interface</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span>\n\n  <span class=\"token key atrule\">do-ip4</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">do-ip6</span><span class=\"token punctuation\">:</span> yes\n\n  <span class=\"token comment\"># アクセス制限 ローカルのみ許可</span>\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> 0.0.0.0/0 refuse\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>1/0 refuse\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> 127.0.0.1/32 allow\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> 192.168.0.0/24 allow\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>1/128 allow\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> fd00<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>/8 allow\n  <span class=\"token key atrule\">access-control</span><span class=\"token punctuation\">:</span> fe80<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>/64 allow\n\n  <span class=\"token key atrule\">prefetch</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">hide-identity</span><span class=\"token punctuation\">:</span> yes\n  <span class=\"token key atrule\">hide-version</span><span class=\"token punctuation\">:</span> yes\n\n  <span class=\"token comment\"># 逆引き</span>\n  <span class=\"token key atrule\">local-data</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"hoge.com. IN A 1.1.1.1\"</span>\n\n<span class=\"token comment\"># Google DNS</span>\n<span class=\"token key atrule\">forward-zone</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\".\"</span>\n  <span class=\"token key atrule\">forward-addr</span><span class=\"token punctuation\">:</span> 8.8.8.8\n  <span class=\"token key atrule\">forward-addr</span><span class=\"token punctuation\">:</span> 8.8.4.4\n  <span class=\"token key atrule\">forward-addr</span><span class=\"token punctuation\">:</span> 2001<span class=\"token punctuation\">:</span>4860<span class=\"token punctuation\">:</span>4860<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">8888</span>\n  <span class=\"token key atrule\">forward-addr</span><span class=\"token punctuation\">:</span> 2001<span class=\"token punctuation\">:</span>4860<span class=\"token punctuation\">:</span>4860<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">8844</span></code></pre></div>\n<p><code class=\"language-text\">local-data:</code>のところが逆引き設定．\nforward-zoneはGoogleのDNSを設定している．\nあとはルータでDNSサーバが参照されるようにすればOK．</p>","tableOfContents":"<ul>\n<li><a href=\"#%E8%87%AA%E5%AE%85dns%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B%E7%90%86%E7%94%B1\">自宅DNSサーバを立てる理由</a></li>\n<li><a href=\"#%E6%8A%80%E8%A1%93%E9%81%B8%E5%AE%9A\">技術選定</a></li>\n<li><a href=\"#install\">install</a></li>\n</ul>","excerpt":"本ページでは，自宅ネットワーク内にDNSサーバを立ち上げる方法についてメモを書く． 今回はunboundを使って構築する． 自宅DNSサーバを立てる理由 自宅に内向きDNSサーバを立てるメリットは以下があげられる． プロバイダーの提供するDNS…","frontmatter":{"title":"unboundで内向きDNSを作る(Ubuntu20.04)","date":"2021.12.05","update":"2021.12.05","category":"Server","tags":["Linux","Ubuntu","Server","Home Lab"]},"fields":{"slug":"/posts/2021-12-05-unbound-dns-ubuntu/"}}},"pageContext":{"id":"62d8fa19-e264-5415-aba9-05499a16bcd9"}},"staticQueryHashes":["1123391092"],"slicesMap":{}}