{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/posts/2022-04-05-gitlab-apache/",
    "result": {"data":{"site":{"siteMetadata":{"title":"MJUN Tech Note","author":"Junya Morioka"}},"mdx":{"id":"375388ab-249d-57af-86de-34f5e4aabeca","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"UbuntuでGitLabをapache経由でproxyする\",\n  \"tags\": [\"Server\", \"Linux\", \"Ubuntu\", \"GitLab\"],\n  \"category\": \"Server\",\n  \"date\": \"2022-04-05T00:00:00.000Z\",\n  \"update\": \"2022-04-05T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u4ECA\\u56DE\\u306FUbuntu\\u3067Apache\\u3092\\u4F7F\\u3063\\u3066Gitlab\\u3092\\u30B5\\u30D6\\u30C7\\u30A3\\u30EC\\u30AF\\u30C8\\u30EA\\u3067\\u7ACB\\u3066\\u308B\\u65B9\\u6CD5\\u3067\\u3059\\uFF0E\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"SSL\\u8A3C\\u660E\\u66F8\\u306FGitLab\\u3067\\u306F\\u306A\\u304F\\uFF0CApache\\u3068certbot\\u3067\\u7BA1\\u7406\\u3057\\u307E\\u3059\\uFF0E  \"), mdx(\"p\", null, \"\\u4ECA\\u56DE\\u306E\\u30B4\\u30FC\\u30EB\\u306F\\uFF0C\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"https://hoge.com/gitlab\"), \"\\u306BGitLab\\u3092\\u7ACB\\u3066\\u308B\\u3053\\u3068\\u3067\\u3059\\uFF0E\"), mdx(\"h2\", {\n    \"id\": \"apacheのインストール\"\n  }, \"apache\\u306E\\u30A4\\u30F3\\u30B9\\u30C8\\u30FC\\u30EB\"), mdx(\"p\", null, \"\\u307E\\u305A\\u306Fapache2\\u306E\\u30A4\\u30F3\\u30B9\\u30C8\\u30FC\\u30EB\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"apt\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"install\"), \" apache2\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" systemctl status apache\"))), mdx(\"h2\", {\n    \"id\": \"certbotの導入\"\n  }, \"certbot\\u306E\\u5C0E\\u5165\"), mdx(\"p\", null, \"\\u6B21\\u306Bcertbot\\u3092\\u5C0E\\u5165\\u3057\\u307E\\u3059\\uFF0E\\u4E88\\u3081\\uFF0C\\u767B\\u9332\\u7528\\u306E\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\\u3068\\u30C9\\u30E1\\u30A4\\u30F3\\u3092\\u7528\\u610F\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"apt\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"install\"), \" certbot python3-certbot-apache\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" certbot --apache\\n\\nEnter email address \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"used \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"for\"), \" urgent renewal and security notices\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"Enter \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'c'\"), \" to\\ncancel\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \": hoge@hoge.com\\n\\nYou must agree \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"in\"), \" order to register with the ACME server at\\nhttps://acme-v02.api.letsencrypt.org/directory\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"A\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"gree/\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"C\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"ancel: A\\n\\nWould you be willing to share your email address with the Electronic Frontier\\nFoundation, a founding partner of the Let s Encrypt project and the non-profit\\norganization that develops Certbot?\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"Y\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"es/\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"N\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"o: N\\n\\nWhich names would you like to activate HTTPS for?\\n----------------------------------------\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), \": hoge.com\\n----------------------------------------\\n \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"Enter \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'c'\"), \" to cancel\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \": \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), \"\\n\\nPlease choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\\n----------------------------------------\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), \": No redirect\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), \": Redirect\\n----------------------------------------\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"press \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'c'\"), \" to cancel\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \": \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), \"\\n\\nCongratulations\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), \" You have successfully enabled https://hoge.com\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# \\u81EA\\u52D5\\u66F4\\u65B0\\u304C\\u50CD\\u3044\\u3066\\u3044\\u308B\\u304B\\u3092\\u78BA\\u8A8D\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" systemctl status certbot.timer\"))), mdx(\"h2\", {\n    \"id\": \"apacheの設定\"\n  }, \"apache\\u306E\\u8A2D\\u5B9A\"), mdx(\"p\", null, \"\\u6B21\\u306B\\uFF0Capache\\u306BProxy\\u306E\\u8A2D\\u5B9A\\u3092\\u3057\\u307E\\u3059\\uFF0E\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"/etc/apache2/sites-enabled/000-default-le-ssl.conf\"), \"\\u306B\\u4EE5\\u4E0B\\u3092\\u52A0\\u7B46\\u3057\\u307E\\u3059\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"ProxyPass /gitlab http://localhost:8000/gitlab\\nProxyPassReverse /gitlab http://localhost:8000/gitlab\"))), mdx(\"p\", null, \"\\u3064\\u3044\\u3067\\u306Bapache\\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u304C\\u5916\\u304B\\u3089\\u898B\\u3048\\u306A\\u3044\\u3088\\u3046\\u306B\\uFF0C\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"/etc/apache2/conf-enabled/security.conf\"), \"\\u3092\\u7DE8\\u96C6\\u3057\\u307E\\u3059\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"ServerTokens Prod\\nServerSignature Off\"))), mdx(\"p\", null, \"\\u8A2D\\u5B9A\\u304C\\u7D42\\u308F\\u3063\\u305F\\u3089\\uFF0Capache\\u3092\\u518D\\u8D77\\u52D5\\u3057\\u307E\\u3059\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"sudo\"), \" systemctl restart apache\"))), mdx(\"h2\", {\n    \"id\": \"gitlabの立ち上げ\"\n  }, \"GitLab\\u306E\\u7ACB\\u3061\\u4E0A\\u3052\"), mdx(\"p\", null, \"\\u4ECA\\u56DE\\u306Fdocker-compose\\u3067GitLab\\u3092\\u7ACB\\u3061\\u4E0A\\u3052\\u307E\\u3059\\uFF0E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"yaml\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-yaml\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"version\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'3.7'\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"services\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"gitlab\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"image\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" gitlab/gitlab\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \"ce\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"14.7.7\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \"ce.0\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"restart\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" always\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"hostname\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'hoge.com'\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"environment\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"GITLAB_OMNIBUS_CONFIG\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"|\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar string\"\n  }, \"\\n        external_url 'http://hoge.com/gitlab/'\\n        gitlab_rails['gitlab_shell_ssh_port'] = 22\\n        gitlab_rails['time_zone'] = 'Asia/Tokyo'\\n        letsencrypt['enable'] = false\\n        nginx['listen_port'] = 8088\"), \"\\n\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"ports\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'8000:8000'\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'22:22'\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token key atrule\"\n  }, \"volumes\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \" ./gitlab/data\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"/var/opt/gitlab\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \" ./gitlab/logs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"/var/log/gitlab\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"-\"), \" ./gitlab/config\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"/etc/gitlab\"))), mdx(\"p\", null, \"SSL\\u8A3C\\u660E\\u66F8\\u306Fapache\\u3067\\u7BA1\\u7406\\u3059\\u308B\\u306E\\u3067\\uFF0C\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"letsencrypt['enable'] = false\"), \"\\u3068\\u3057\\u3066\\u304A\\u304D\\u307E\\u3059\\uFF0E  \"), mdx(\"p\", null, \"\\u4EE5\\u4E0A\\u3067apache\\u7D4C\\u7531\\u3067\\u4EFB\\u610F\\u306E\\u30B5\\u30D6\\u30C7\\u30A3\\u30EC\\u30AF\\u30C8\\u30EA\\u3067GitLab\\u306B\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u307E\\u3059\\uFF0E\"));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#apacheのインストール","title":"apacheのインストール"},{"url":"#certbotの導入","title":"certbotの導入"},{"url":"#apacheの設定","title":"apacheの設定"},{"url":"#gitlabの立ち上げ","title":"GitLabの立ち上げ"}]},"excerpt":"今回はUbuntuでApacheを使ってGitlabをサブディレクトリで立てる方法です． SSL証明書はGitLabではなく，Apacheとcertbotで管理します．   今回のゴールは， https://hoge.com/gitlab にGitLab…","frontmatter":{"title":"UbuntuでGitLabをapache経由でproxyする","date":"2022.04.05","update":"2022.04.05","category":"Server","tags":["Server","Linux","Ubuntu","GitLab"]},"fields":{"slug":"/posts/2022-04-05-gitlab-apache/"}}},"pageContext":{"id":"375388ab-249d-57af-86de-34f5e4aabeca"}},
    "staticQueryHashes": []}