{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/posts/2022-04-18-torchrun/",
    "result": {"data":{"site":{"siteMetadata":{"title":"MJUN Tech Note","author":"Junya Morioka"}},"mdx":{"id":"ace11433-ad8c-5cf2-8de6-77c9237d0196","body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"PyTorchのMultiGPUの概要 【DataParallel, DistributedDataParallel, torchrun】\",\n  \"tags\": [\"PyTorch\", \"Python\"],\n  \"category\": \"PyTorch\",\n  \"date\": \"2022-04-18T00:00:00.000Z\",\n  \"update\": \"2022-07-27T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u6A5F\\u68B0\\u5B66\\u7FD2\\u30E9\\u30A4\\u30D6\\u30E9\\u30EA\\u306E PyTorch \\u306B\\u306F\\u3001\\u8907\\u6570\\u306E\\u30DE\\u30B7\\u30F3\\u30FBGPU \\u3067\\n\\u5B66\\u7FD2\\u3092\\u884C\\u3046\\u65B9\\u6CD5\\u304C\\u3044\\u304F\\u3064\\u304B\\u7528\\u610F\\u3055\\u308C\\u3066\\u3044\\u308B\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u3053\\u306E\\u8A18\\u4E8B\\u3092\\u66F8\\u3044\\u3066\\u3044\\u308B\\u73FE\\u5728\\u3001PyTorch \\u306E stable version \\u306F\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"1.11.0\"), \"\\u3067\\u3042\\u308B\\u304C\\u3001\\n\\u5B9F\\u884C\\u65B9\\u6CD5\\u304C\\u3001\\u76F4\\u8FD1\\u306E version\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"1.9.0\"), \"\\u3068\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"1.10.0\"), \"\\u3067\\u5909\\u66F4\\u30FB\\u8FFD\\u52A0\\u304C\\u3042\\u3063\\u305F\\u306E\\u3067\\u307E\\u3068\\u3081\\u308B\\u3002\"), mdx(\"h2\", {\n    \"id\": \"dataparallel-と-distributeddataparallel\"\n  }, \"DataParallel \\u3068 DistributedDataParallel\"), mdx(\"p\", null, \"PyTorch \\u3067\\u8907\\u6570\\u306E GPU \\u3092\\u7528\\u3044\\u305F Training \\u306E\\u5B9F\\u88C5\\u65B9\\u6CD5\\u306F 2 \\u3064\\u3042\\u308B\\u3002\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"torch.nn.DataParallel\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"torch.nn.DistributedDataParallel\"))), mdx(\"p\", null, \"\\u3053\\u306E\\uFF12\\u3064\\u306E\\u9055\\u3044\\u306F\\u3001\\u8907\\u6570\\u306E GPU \\u306B\\u5272\\u308A\\u5F53\\u3066\\u3089\\u308C\\u308BCPU\\u30B3\\u30A2\\u304C\\n\\u5168\\u4F53\\u30671\\u3064\\u304B\\u5404GPU\\u306B\\u8907\\u6570\\u304B\\u3067\\u3042\\u308B\\u3002\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/f267346af6b6d553c5249a7e92c166b6/f43b1/torch_dist.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.99999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHtTaQFf//EABkQAAIDAQAAAAAAAAAAAAAAAAABAhARMf/aAAgBAQABBQKWktQuX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABICH/2gAIAQEABj8CRk//xAAaEAADAQADAAAAAAAAAAAAAAAAAREhEDFB/9oACAEBAAE/IXqF7GbJbzDopBpN8f/aAAwDAQACAAMAAAAQA8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAXEQEAAwAAAAAAAAAAAAAAAAABECEx/9oACAECAQE/EE24/8QAGhABAQADAQEAAAAAAAAAAAAAAREAITFxUf/aAAgBAQABPxA+7p2PPuuYytC9lrfcSoIwpiLYXzDFOY60Z//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"nvidia-diff-parallel\",\n    \"title\": \"nvidia-diff-parallel\",\n    \"src\": \"/static/f267346af6b6d553c5249a7e92c166b6/4b190/torch_dist.jpg\",\n    \"srcSet\": [\"/static/f267346af6b6d553c5249a7e92c166b6/e07e9/torch_dist.jpg 200w\", \"/static/f267346af6b6d553c5249a7e92c166b6/066f9/torch_dist.jpg 400w\", \"/static/f267346af6b6d553c5249a7e92c166b6/4b190/torch_dist.jpg 800w\", \"/static/f267346af6b6d553c5249a7e92c166b6/e5166/torch_dist.jpg 1200w\", \"/static/f267346af6b6d553c5249a7e92c166b6/f43b1/torch_dist.jpg 1426w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"\\u4E0A\\u8A18\\u306E\\u56F3\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-1\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-1\",\n    \"className\": \"footnote-ref\"\n  }, \"1\")), \"\\u306E\\u3088\\u3046\\u306B\\u3001Python \\u306E GIL \\u306E\\u90FD\\u5408\\u3082\\u3042\\u308A\\u3001\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\u3092\\u4F7F\\u3063\\u305F\\u307B\\u3046\\u304C\\u5404 GPU \\u306B\\u500B\\u5225\\u306E CPU \\u30B3\\u30A2\\u3092\\u5272\\u308A\\u5F53\\u3066\\u3089\\u308C\\u308B\\u306E\\u3067\\u3001\\n\\u30EA\\u30BD\\u30FC\\u30B9\\u3092\\u5B58\\u5206\\u306B\\u4F7F\\u3046\\u3053\\u3068\\u304C\\u3067\\u304D\\u308B\\u3002\\n\\u307E\\u305F\\u3001\\u8907\\u6570\\u306E\\u30DE\\u30B7\\u30F3(Multi-node)\\u3067\\u5B9F\\u884C\\u3067\\u304D\\u308B\\u306E\\u3082\\u5F37\\u307F\\u3067\\u3042\\u308B\\u3002\\n\\u5B9F\\u969B\\u3001\\u516C\\u5F0F\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-2\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-2\",\n    \"className\": \"footnote-ref\"\n  }, \"2\")), \"\\u3067\\u3082\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\u304C\\u52E7\\u3081\\u3089\\u308C\\u3066\\u3044\\u308B\\u3002\"), mdx(\"p\", null, \"\\u3053\\u3053\\u307E\\u3067\\u304F\\u308B\\u3068\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DataParallel\"), \"\\u306E\\u30E1\\u30EA\\u30C3\\u30C8\\u304C\\u611F\\u3058\\u3089\\u308C\\u306A\\u3044\\u304C\\u3001\\u5B9F\\u88C5\\u306E\\u9055\\u3044\\u3092\\n\\u898B\\u308B\\u3068\\u5229\\u70B9\\u304C\\u898B\\u3048\\u3066\\u304F\\u308B\\u3002\"), mdx(\"p\", null, \"\\u307E\\u305A\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DataParallel\"), \"\\u306E\\u5B9F\\u88C5\\u306F\\u4EE5\\u4E0B\\u3067\\u3042\\u308B\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"python\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-python\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" torch\\n\\nmodel \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" hoge\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"+\"), \" model \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"nn\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"DataParallel\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"model\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" device_ids\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"3\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"p\", null, \"\\u4E0A\\u8A18\\u306E\\u3088\\u3046\\u306B\\u65E2\\u5B58\\u306E\\u30E2\\u30C7\\u30EB(\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.nn.Model\"), \")\\u306B\\u5BFE\\u3057\\u3066\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.nn.DataParallel\"), \"\\u3092\\u30E9\\u30C3\\u30D7\\u3059\\u308B\\u3060\\u3051\\u3067\\n\\u5B9F\\u88C5\\u3067\\u304D\\u3001\\u65E2\\u5B58\\u306E\\u30B3\\u30FC\\u30C9\\u3092 1 \\u884C\\u5909\\u66F4\\u3059\\u308B\\u3060\\u3051\\u3067\\u5B9F\\u88C5\\u3059\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u308B\\u3002\"), mdx(\"p\", null, \"\\u6B21\\u306B\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\u306E\\u5B9F\\u88C5\\u4F8B\\u3092\\u78BA\\u8A8D\\u3059\\u308B\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"python\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-python\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" os\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" torch\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"distributed \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"as\"), \" dist\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"nn\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"parallel \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" DistributedDataParallel \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"as\"), \" DDP\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"utils\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"data\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"distributed \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" DistributedSampler\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# \\u3069\\u306EGPU\\u30D7\\u30ED\\u30BB\\u30B9\\u756A\\u53F7\\u304B\\u304CLocal Rank\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# GPU ID = 1\\u306E\\u6642\\u3001local_rank=1\"), \"\\nlocal_rank \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" os\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"getenv\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'LOCAL_RANK'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# \\u901A\\u4FE1\\u65B9\\u6CD5\\u306E\\u898F\\u5B9A\\u3068\\u30D7\\u30ED\\u30BB\\u30B9\\u30B0\\u30EB\\u30FC\\u30D7\\u306E\\u521D\\u671F\\u5316\"), \"\\ndist\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"init_process_group\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"backend\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'nccl'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" init_method\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'env://'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\ndataset \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" Dataset\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"hoge\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# DistributedSampler\\u3092\\u4F7F\\u3046\"), \"\\nsampler \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" DistributedSampler\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"dataset\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" rank\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"local_rank\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\ndataloaders \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"utils\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"data\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"DataLoader\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"dataset\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                          batch_size\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"16\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                          sampler\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"Distributed\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# DistributedDataParallel\\u3067\\u30E9\\u30C3\\u30D7\"), \"\\nmodel \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" Model\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"fuga\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nmodel \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" DDP\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"model\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# ...\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# Training\\u7D42\\u4E86\"), \"\\ndist\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"destroy_process_group\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\u3067\\u306F\\u3001\\u30B7\\u30F3\\u30B0\\u30EB\\u30FB\\u30DE\\u30EB\\u30C1\\u30DE\\u30B7\\u30F3\\u306E\\u5834\\u5408\\u3082\\u540C\\u3058\\u66F8\\u304D\\u65B9\\u304C\\u3067\\u304D\\u308B\\u3088\\u3046\\u306B\\n\\u8A2D\\u8A08\\u3055\\u308C\\u3066\\u3044\\u308B\\u305F\\u3081\\u3001\\u65B0\\u305F\\u306B\\u5B9F\\u88C5\\u3059\\u308B\\u90E8\\u5206\\u304C\\u591A\\u3044\\u3002\\n\\u30DE\\u30EB\\u30C1\\u30D7\\u30ED\\u30BB\\u30B9\\u306B\\u306A\\u3063\\u305F\\u5206\\u3001\\u81EA\\u5206\\u304C\\u4ECA\\u3069\\u306E\\u30D7\\u30ED\\u30BB\\u30B9\\u306B\\u3044\\u308B\\u306E\\u304B\\u3092\\u610F\\u8B58\\u3057\\u306A\\u304C\\u3089\\u5B9F\\u88C5\\u3092\\u9032\\u3081\\u308B\\u5FC5\\u8981\\u304C\\u3042\\u308B\\u3002\"), mdx(\"p\", null, \"\\u4E0A\\u8A18\\u306E\\u901A\\u308A\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DataParallel\"), \"\\u306F 1 \\u884C\\u3067\\u65E2\\u5B58\\u306E\\u30B3\\u30FC\\u30C9\\u3092\\u5909\\u66F4\\u3059\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u308B\\u304C\\u3001\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\u306F\\u591A\\u5C11\\u306E\\u8FFD\\u52A0\\u5B9F\\u88C5\\u304C\\u5FC5\\u8981\\u306B\\u306A\\u308B\\u3002\\n\\u624B\\u8EFD\\u306B\\u8907\\u6570 GPU \\u3067\\u306E Training \\u3092\\u8A66\\u3057\\u305F\\u3044\\u5834\\u5408\\u306F\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DataParallel\"), \"\\u3092\\u7528\\u3044\\u308B\\u3068\\u3088\\u3044\\u3002\"), mdx(\"p\", null, \"\\u6B21\\u7AE0\\u3067\\u306F\\u65B0\\u305F\\u306B\\u8FFD\\u52A0\\u3055\\u308C\\u305F\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torchrun\"), \"\\u306B\\u3064\\u3044\\u3066\\u8B70\\u8AD6\\u3059\\u308B\\u305F\\u3081\\u3001\\u4EE5\\u4E0B\\u304B\\u3089\\u306F\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"DistributedDataParallel\"), \"\\n\\u3092\\u7528\\u3044\\u305F\\u5834\\u5408\\u306B\\u3064\\u3044\\u3066\\u8003\\u3048\\u308B\\u3002\"), mdx(\"h2\", {\n    \"id\": \"distributeddataparallel-の実行方法\"\n  }, \"DistributedDataParallel \\u306E\\u5B9F\\u884C\\u65B9\\u6CD5\"), mdx(\"p\", null, \"DistributedDataParallel \\u306E\\u5B9F\\u884C\\u65B9\\u6CD5\\u306F\\u3001\\u5927\\u304D\\u304F\\u5206\\u3051\\u3066\\u4EE5\\u4E0B\\u306E\\uFF12\\u3064\\u3042\\u308B\\u3002\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u7279\\u5B9A\\u306E\\u95A2\\u6570\\u306B\\u3064\\u3044\\u3066 GPU \\u4E26\\u5217\\u5316\\u3092\\u884C\\u3046\\u65B9\\u6CD5(\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"mp.spawn\"), \")\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"\\u30B9\\u30AF\\u30EA\\u30D7\\u30C8\\u3054\\u3068 GPU \\u4E26\\u5217\\u5316\\u3059\\u308B\\u65B9\\u6CD5(\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"torchrun\"), \", \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.run\"), \", \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \")\")), mdx(\"h3\", {\n    \"id\": \"1-関数について並列化\"\n  }, \"1. \\u95A2\\u6570\\u306B\\u3064\\u3044\\u3066\\u4E26\\u5217\\u5316\"), mdx(\"p\", null, \"1 \\u306E\\u95A2\\u6570\\u3054\\u3068\\u306B\\u4E26\\u5217\\u5316\\u3059\\u308B\\u65B9\\u6CD5\\u306F\\u3001\\u30B3\\u30FC\\u30C9\\u5185\\u3067 Training \\u3092\\u884C\\u3046\\u95A2\\u6570\\u3092\\u66F8\\u3044\\u3066\\u3001\\u4F7F\\u7528\\u3059\\u308B GPU \\u306E\\u6570\\u3084\\n\\u901A\\u4FE1\\u65B9\\u6CD5\\u3082\\u30B3\\u30FC\\u30C9\\u5185\\u3067\\u8A2D\\u5B9A\\u3057\\u3066\\u5B9F\\u884C\\u3059\\u308B\\u3053\\u3068\\u304C\\u3067\\u304D\\u308B\\u3002\\n\\u3064\\u307E\\u308A\\u3001\\u30B7\\u30F3\\u30B0\\u30EB GPU \\u3067\\u3042\\u3063\\u3066\\u3082\\u3001\\u8907\\u6570 GPU \\u306E\\u30B3\\u30FC\\u30C9\\u3067\\u3042\\u3063\\u3066\\u3082\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"python train.py\"), \"\\u3068\\u3001\\n\\u540C\\u3058\\u30B3\\u30DE\\u30F3\\u30C9\\u306E\\u5B9F\\u884C\\u3067\\u5B66\\u7FD2\\u304C\\u884C\\u3048\\u308B\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u5B9F\\u88C5\\u4F8B\\u306F PyTorch \\u516C\\u5F0F\\u306E ImageNet \\u5B66\\u7FD2\\u306E\\u5B9F\\u88C5\\u306B\\u66F8\\u304B\\u308C\\u3066\\u3044\\u308B\\u3002\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/pytorch/examples/tree/main/imagenet\"\n  }, \"https://github.com/pytorch/examples/tree/main/imagenet\")), mdx(\"p\", null, \"2 \\u306E\\u65B9\\u6CD5\\u3068\\u5927\\u304D\\u304F\\u7570\\u306A\\u308B\\u90E8\\u5206\\u304C\\u3001\\u4EE5\\u4E0B\\u306E\\u90E8\\u5206\\u3067\\u3042\\u308B\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"python\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-python\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" torch\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"multiprocessing \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"as\"), \" mp\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"def\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"train\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"rank\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" hoge\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n    dist\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"init_process_group\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"backend\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'nccl'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" init_method\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'env://'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"def\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"main\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \"\\n    mp\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"spawn\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"train\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" nprocs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"ngpus_per_node\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"hoge\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"p\", null, \"\\u4E0A\\u8A18\\u306E\\u901A\\u308A\\u3001\\u30B3\\u30FC\\u30C9\\u81EA\\u4F53\\u306F Python \\u6A19\\u6E96\\u30E2\\u30B8\\u30E5\\u30FC\\u30EB\\u306E multiprocessing \\u3068\\u5909\\u308F\\u308A\\u306A\\u3044\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u3057\\u304B\\u3057\\u3001\\u6A19\\u6E96\\u30E2\\u30B8\\u30E5\\u30FC\\u30EB\\u306F CUDA Initialized \\u3092\\u8907\\u6570\\u884C\\u3063\\u3066\\u3057\\u307E\\u3044\\u3001\\u30A8\\u30E9\\u30FC\\u304C\\u767A\\u751F\\u3059\\u308B\\u305F\\u3081\\u3001\\nmultiprocessing \\u30E2\\u30B8\\u30E5\\u30FC\\u30EB\\u3092\\u30E9\\u30C3\\u30D7\\u3057\\u305F\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.multiprocessing\"), \"\\u3092\\u4F7F\\u7528\\u3059\\u308B\\u3002\"), mdx(\"h3\", {\n    \"id\": \"2-スクリプトごと並列化\"\n  }, \"2. \\u30B9\\u30AF\\u30EA\\u30D7\\u30C8\\u3054\\u3068\\u4E26\\u5217\\u5316\"), mdx(\"p\", null, \"2 \\u306E\\u65B9\\u6CD5\\u306B\\u3064\\u3044\\u3066\\u306F PyTorch \\u306E\\u30D0\\u30FC\\u30B8\\u30E7\\u30F3\\u306B\\u3088\\u3063\\u3066\\u5B9F\\u884C\\u65B9\\u6CD5\\u304C\\u7570\\u306A\\u3063\\u3066\\u304A\\u308A\\u3001\\nversion 1.9.0 \\u4EE5\\u524D\\u306F\\u3001\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"python -m torch.distributed.launch --nproc_per_node=4 --nnodes=1 --node_rank 0 train.py\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u3067\\u5B9F\\u884C\\u3055\\u308C\\u3066\\u3044\\u305F\\u304C\\u3001version 1.9.0 \\u4EE5\\u964D\\u306F TorchElastic \\u304C\\u8FFD\\u52A0\\u3055\\u308C\\u305F\\u5F71\\u97FF\\u3067\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"python -m torch.distributed.run --nproc_per_node=4 --nnodes=1 --node_rank 0 train.py\"), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u3067\\u3082\\u5B9F\\u884C\\u3067\\u304D\\u308B\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u307E\\u305F\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \"\\u306E super set \\u3068\\u3057\\u3066\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torchrun\"), \"\\u304C Version 1.10.0 \\u304B\\u3089\\u63D0\\u4F9B\\u3055\\u308C\\u3066\\u3044\\u308B\\u3002\"), mdx(\"p\", null, \"\\u3053\\u3053\\u3067\\u306F\\u5F93\\u6765\\u306E\\u65B9\\u6CD5\\u3067\\u3042\\u308B\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \"\\u3068\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.run\"), \"\\u306B\\u3064\\u3044\\u3066\\u8FF0\\u3079\\u308B\\u3002\"), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \"\\u3068\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.run\"), \"\\u306E\\u5834\\u5408\\u3001\\n\\u5B9F\\u884C\\u30B9\\u30AF\\u30EA\\u30D7\\u30C8\\u306E\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"train.py\"), \"\\u306B\\u306F\\u30B3\\u30DE\\u30F3\\u30C9\\u30E9\\u30A4\\u30F3\\u5F15\\u6570\\u3068\\u3057\\u3066\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"--local_rank\"), \"\\u3092\\u53D7\\u3051\\u53D6\\u308C\\u308B\\u3088\\u3046\\u306B\\u5B9F\\u88C5\\u3059\\u308B\\u5FC5\\u8981\\u304C\\u3042\\u308B\\u3002\\u4E0B\\u306B\\u4F8B\\u3092\\u793A\\u3059\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"python\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-python\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" argparse\\nparser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" argparse\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"ArgumentParser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nparser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"add_argument\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"--local_rank\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"type\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"int\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nargs \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" parser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"parse_args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\nlocal_rank \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"local_rank\"))), mdx(\"p\", null, \"\\u3053\\u308C\\u4EE5\\u5916\\u306E\\u5B9F\\u88C5\\u306F 1 \\u306E\\u95A2\\u6570\\u3054\\u3068\\u306B multiprocessing \\u3059\\u308B\\u5834\\u5408\\u3068\\u5909\\u308F\\u3089\\u306A\\u3044\\u3002\"), mdx(\"h3\", {\n    \"id\": \"1-と-2-の実行方法の違いについて\"\n  }, \"1 \\u3068 2 \\u306E\\u5B9F\\u884C\\u65B9\\u6CD5\\u306E\\u9055\\u3044\\u306B\\u3064\\u3044\\u3066\"), mdx(\"p\", null, \"1 \\u306E\\u95A2\\u6570\\u3092 multiprocessing \\u3059\\u308B\\u65B9\\u6CD5\\u3068\\u3001\\u30B9\\u30AF\\u30EA\\u30D7\\u30C8\\u81EA\\u4F53\\u3092 multiprocessing \\u3059\\u308B\\u65B9\\u6CD5\\u306F\\u3001\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"%5E3\"\n  }, \"\\u3053\\u3061\\u3089\\u306E\\u516C\\u5F0F\\u30D5\\u30A9\\u30FC\\u30E9\\u30E0\"), \"\\n\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-3\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-3\",\n    \"className\": \"footnote-ref\"\n  }, \"3\")), \"\\u3067\\u3082\\u8A00\\u53CA\\u3055\\u308C\\u3066\\u3044\\u308B\\u3088\\u3046\\u306B\\u3001\\n\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"multiprocessing(1) vs subprocess(2)\"), \"\\u306E\\u9055\\u3044\\u3068\\u3044\\u3048\\u308B\\u3002\"), mdx(\"p\", null, \"Github \\u306E Issue\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-4\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-4\",\n    \"className\": \"footnote-ref\"\n  }, \"4\")), \" \", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-5\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-5\",\n    \"className\": \"footnote-ref\"\n  }, \"5\")), \"\\u3067\\u306F\\u30011 \\u306E\\u65B9\\u6CD5\\u304C GPU \\u3078\\u306E\\u8EE2\\u9001\\u901F\\u5EA6\\u306E\\u95A2\\u4FC2\\u3067\\u9045\\u3044\\u3068\\u3044\\u3046\\u5831\\u544A\\u3082\\u3042\\u308B\\u3002\\n\\u9577\\u3044\\u6642\\u9593\\u306E\\u5B66\\u7FD2\\u3067\\u306F\\u7121\\u8996\\u3067\\u304D\\u308B\\u3088\\u3046\\u3060\\u304C\\u3001\\u53C2\\u8003\\u3068\\u3057\\u3066\\u304A\\u304D\\u305F\\u3044\\u3002\"), mdx(\"h2\", {\n    \"id\": \"新しい実行方法-torchrun\"\n  }, \"\\u65B0\\u3057\\u3044\\u5B9F\\u884C\\u65B9\\u6CD5 \", mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"torchrun\")), mdx(\"p\", null, \"PyTorch \\u306E Version 1.10.0 \\u304B\\u3089\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \"\\u306E super set \\u3068\\u3057\\u3066\\u3001\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torchrun\"), \"\\u304C\\u767B\\u5834\\u3057\\u3066\\u3044\\u308B\\u3002\"), mdx(\"p\", null, \"\\u516C\\u5F0F\\u30C9\\u30AD\\u30E5\\u30E1\\u30F3\\u30C8\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-6\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-6\",\n    \"className\": \"footnote-ref\"\n  }, \"6\")), \"\\u306B\\u308F\\u304B\\u308A\\u3084\\u3059\\u3044\\u79FB\\u884C\\u624B\\u9806\\u304C\\u3042\\u308B\\u306E\\u3067\\u3001\\u4E00\\u8AAD\\u3092\\u304A\\u52E7\\u3081\\u3059\\u308B\\u3002\"), mdx(\"p\", null, \"\\u5177\\u4F53\\u7684\\u306B\\u306F\\u3001\\u5B9F\\u884C\\u30B3\\u30DE\\u30F3\\u30C9\\u304C\\u4EE5\\u4E0B\\u306E\\u3088\\u3046\\u306B\\u5909\\u66F4\\u3055\\u308C\\u3001\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-bash\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# use_env\\u306FLOCAL RANK\\u3092argparse\\u3067\\u306F\\u306A\\u304F\\u3001\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# \\u74B0\\u5883\\u5909\\u6570\\u304B\\u3089\\u53D7\\u3051\\u53D6\\u308B\\u30AA\\u30D7\\u30B7\\u30E7\\u30F3\"), \"\\npython -m torch.distributed.launch --use_env train_script.py\\n\\ntorchrun train_script.py\"))), mdx(\"p\", null, \"argparse \\u3067\\u53D7\\u3051\\u53D6\\u3063\\u3066\\u3044\\u305F local rank \\u3092\\u74B0\\u5883\\u5909\\u6570\\u304B\\u3089\\u53D7\\u3051\\u53D6\\u308B\\u3088\\u3046\\u306B\\u306A\\u308B\\u3002\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"python\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-python\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# torch.distributed.launch\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" argparse\\nparser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" argparse\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"ArgumentParser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nparser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"add_argument\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"--local_rank\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"type\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"int\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nargs \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" parser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"parse_args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\nlocal_rank \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"local_rank\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"# torchrun\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" os\\nlocal_rank \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"int\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"os\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"environ\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"LOCAL_RANK\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"p\", null, \"\\u307B\\u3068\\u3093\\u3069\\u4F7F\\u7528\\u611F\\u306F\\u5909\\u308F\\u308A\\u306A\\u3044\\u304C\\u3001\\u308F\\u3056\\u308F\\u3056 argparse \\u3067\\u5F15\\u6570\\u306E\\u53D7\\u53D6\\u5148\\u3092\\u4F5C\\u3089\\u306A\\u304F\\u3066\\u3088\\u304F\\u306A\\u3063\\u305F\\u306E\\u306F\\u3001\\n\\u30B3\\u30DE\\u30F3\\u30C9\\u30E9\\u30A4\\u30F3\\u5F15\\u6570\\u306E\\u540D\\u524D\\u7A7A\\u9593\\u3092\\u6C5A\\u3055\\u308C\\u306A\\u304F\\u3066\\u6E08\\u3080\\u306E\\u3067\\u5229\\u70B9\\u304C\\u3042\\u308B\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"\\u4F8B\\u3048\\u3070\\u3001Facebook \\u8B39\\u88FD\\u306E\\u8A2D\\u5B9A\\u7BA1\\u7406\\u30E9\\u30A4\\u30D6\\u30E9\\u30EA\\u306E\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://hydra.cc/\"\n  }, \"Hydra\"), \" \", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-7\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-7\",\n    \"className\": \"footnote-ref\"\n  }, \"7\")), \"\\u3092\\u4F7F\\u3063\\u3066\\u3044\\u308B\\u5834\\u5408\\u3001argparse \\u3068\\u4F75\\u7528\\u304C\\u3067\\u304D\\u306A\\u3044\\u306E\\u3067\\u3001\\ntorchrun \\u3067\\u74B0\\u5883\\u5909\\u6570\\u3092\\u7D4C\\u7531\\u3059\\u308B\\u30E1\\u30EA\\u30C3\\u30C8\\u304C\\u3042\\u308B\\u3002\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"(\\u305F\\u3060\\u3057\\u3001\\u3053\\u3053\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-8\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-8\",\n    \"className\": \"footnote-ref\"\n  }, \"8\")), \" \", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-9\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-9\",\n    \"className\": \"footnote-ref\"\n  }, \"9\")), \"\\u3067\\u8B70\\u8AD6\\u3055\\u308C\\u3066\\u3044\\u308B\\u3088\\u3046\\u306B\\u3001output \\u5468\\u308A\\u304C conflict \\u3059\\u308B\\u554F\\u984C\\u304C\\u3042\\u308B\\u306E\\u3067\\u3001\\n\\u4ECA\\u5F8C\\u306E\\u52D5\\u5411\\u306B\\u6CE8\\u76EE\\u3059\\u308B\\u3079\\u304D\\u3067\\u3042\\u308B\\u3002)\"), mdx(\"p\", null, \"\\u3053\\u3053\", mdx(\"sup\", {\n    parentName: \"p\",\n    \"id\": \"fnref-10\"\n  }, mdx(\"a\", {\n    parentName: \"sup\",\n    \"href\": \"#fn-10\",\n    \"className\": \"footnote-ref\"\n  }, \"10\")), \"\\u3067\\u3001\\u66F8\\u304B\\u308C\\u3066\\u3044\\u308B\\u3088\\u3046\\u306B\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"torch.distributed.launch\"), \"\\n\\u306F\\u5C06\\u6765\\u7684\\u306B deprecated \\u3057\\u305F\\u3044\\u3088\\u3046\\u306A\\u306E\\u3067\\u3001\\u4ECA\\u5F8C\\u306F torchrun \\u3067\\u5B9F\\u88C5\\u3057\\u3066\\u3044\\u304F\\u3079\\u304D\\u3060\\u308D\\u3046\\u3002\"), mdx(\"h2\", {\n    \"id\": \"参考\"\n  }, \"\\u53C2\\u8003\"), mdx(\"div\", {\n    \"className\": \"footnotes\"\n  }, mdx(\"hr\", {\n    parentName: \"div\"\n  }), mdx(\"ol\", {\n    parentName: \"div\"\n  }, mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-1\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://qiita.com/sugulu_Ogawa_ISID/items/62f5f7adee083d96a587#4-multi-gpu%E3%81%AE%E8%A8%AD%E5%AE%9A\"\n  }, \"https://qiita.com/sugulu_Ogawa_ISID/items/62f5f7adee083d96a587#4-multi-gpu%E3%81%AE%E8%A8%AD%E5%AE%9A\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-1\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-2\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://pytorch.org/docs/1.11/notes/cuda.html#use-nn-parallel-distributeddataparallel-instead-of-multiprocessing-or-nn-dataparallel\"\n  }, \"https://pytorch.org/docs/1.11/notes/cuda.html#use-nn-parallel-distributeddataparallel-instead-of-multiprocessing-or-nn-dataparallel\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-2\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-3\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://discuss.pytorch.org/t/torch-distributed-launch-vs-torch-multiprocessing-spawn/95738\"\n  }, \"https://discuss.pytorch.org/t/torch-distributed-launch-vs-torch-multiprocessing-spawn/95738\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-3\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-4\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/pytorch/pytorch/issues/47587\"\n  }, \"https://github.com/pytorch/pytorch/issues/47587\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-4\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-5\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/NVIDIA/apex/issues/549\"\n  }, \"https://github.com/NVIDIA/apex/issues/549\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-5\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-6\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://pytorch.org/docs/1.11/elastic/run.html\"\n  }, \"https://pytorch.org/docs/1.11/elastic/run.html\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-6\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-7\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://hydra.cc/\"\n  }, \"https://hydra.cc/\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-7\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-8\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/facebookresearch/hydra/pull/2119\"\n  }, \"https://github.com/facebookresearch/hydra/pull/2119\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-8\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-9\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/facebookresearch/hydra/issues/2038\"\n  }, \"https://github.com/facebookresearch/hydra/issues/2038\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-9\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")), mdx(\"li\", {\n    parentName: \"ol\",\n    \"id\": \"fn-10\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://pytorch.org/docs/1.11/distributed.html#launch-utility\"\n  }, \"https://pytorch.org/docs/1.11/distributed.html#launch-utility\"), mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#fnref-10\",\n    \"className\": \"footnote-backref\"\n  }, \"\\u21A9\")))));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#dataparallel-と-distributeddataparallel","title":"DataParallel と DistributedDataParallel"},{"url":"#distributeddataparallel-の実行方法","title":"DistributedDataParallel の実行方法"},{"url":"#新しい実行方法-torchrun","title":"新しい実行方法 torchrun"},{"url":"#参考","title":"参考"}]},"excerpt":"機械学習ライブラリの PyTorch には、複数のマシン・GPU で\n学習を行う方法がいくつか用意されている。 この記事を書いている現在、PyTorch の stable version は 1.11.0 であるが、\n実行方法が、直近の version 1.9.0 と 1.1…","frontmatter":{"title":"PyTorchのMultiGPUの概要 【DataParallel, DistributedDataParallel, torchrun】","date":"2022.04.18","update":"2022.07.27","category":"PyTorch","tags":["PyTorch","Python"]},"fields":{"slug":"/posts/2022-04-18-torchrun/"}}},"pageContext":{"id":"ace11433-ad8c-5cf2-8de6-77c9237d0196"}},
    "staticQueryHashes": ["1123391092"]}