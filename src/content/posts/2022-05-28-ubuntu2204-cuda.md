---
title: Ubuntu22.04ã«CUDA, cuDNNï¼ŒDockerï¼ŒNVIDIA-Docker2ã‚’å…¥ã‚Œã‚‹
tags: [Server, Ubuntu, Linux, NVIDIA, CUDA]
category: Server
date: 2022-05-28
update: 2022-05-28
# for Zenn
type: tech
emoji: ğŸ˜–
topics: [Server, Ubuntu, Linux, NVIDIA, CUDA]
published: false
---

Ubuntu22.04 ã« CUDA11.7 ã¨ cuDNN8ï¼Œnvidia-docker2 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ‰‹é †ï¼  
Ubuntu ã¯æœ€å°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ï¼Œã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã§
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã‚’ç”¨æ„ï¼

## CUDA 11.7

ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã™ã‚‹ã¨ï¼ŒCUDA ãŒå‹æ‰‹ã«å…¥ã£ã¦ãã‚‹ã®ã§å…¨éƒ¨å‰Šé™¤ã™ã‚‹ï¼  
(æœ¬å½“ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªã‘ã‚Œã°ã‚ˆã„ãŒï¼ŒWifi ãƒ‰ãƒ©ã‚¤ãƒã¨ã‹å…¥ã£ã¦ã“ãªã„ã¨ã‚ã‚“ã©ã„ã®ã§)

```bash
sudo apt purge *nvidia*
sudo apt autopurge
sudo apt purge nvidia-*
sudo apt purge nvidia-compute-*
sudo apt purge libnvidia*
sudo apt purge linux-objects-nvidia*
```

NVIDIA å…¬å¼ã‹ã‚‰ CUDA ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼

<https://developer.nvidia.com/cuda-downloads>

```bash
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin
sudo mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600
sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/3bf863cc.pub
sudo add-apt-repository "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/ /"
sudo apt-get update
sudo apt-get -y install cuda
sudo apt-get -y install cuda-drivers
```

ã“ã“ã§ä¸€åº¦å†èµ·å‹•ã™ã‚‹ï¼

GPU ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã‹ç¢ºèªã™ã‚‹ãŸã‚ã«ï¼ŒCUDA ã¸ PATH ã‚’é€šã™ï¼

```bash
# CUDA
export PATH=/usr/local/cuda/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
```

`nvidia-smi`ã‚„`nvcc -V`ã‚’è©¦ã™ï¼

## cuDNN ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

cuDNN ã‚’å…¥ã‚Œã‚‹ã«ã¯ NVIDIA ã¸ã®ä¼šå“¡ç™»éŒ²ãŒå¿…è¦ï¼  
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã‹ã‚‰è¡Œã†ï¼  
Local Installer Ubuntu2\*.04 x86_64 ã‚’å…¥ã‚Œã‚‹ï¼22.04 ã§ã¯ 20.04 ã‚’å…¥ã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ã ã£ãŸï¼

<https://developer.nvidia.com/cudnn>

<https://docs.nvidia.com/deeplearning/cudnn/install-guide/index.html>

ä¸Šè¨˜ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ã®é€šã‚Šï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼  
ä»Šå›ã¯ dpkg ã‚’é¸æŠ

```bash
sudo dpkg -i cudnn-local-repo-${OS}-8.x.x.x_1.0-1_amd64.deb
sudo apt-key add /var/cudnn-local-repo-*/7fa2af80.pub
sudo apt-get install libcudnn8
sudo apt-get install libcudnn8-dev
```

## Docker ã‚’å…¥ã‚Œã‚‹

Docker ã¯å…¬å¼ã‚µã‚¤ãƒˆã®æ‰‹é †é€šã‚Šå…¥ã‚Œã‚‹ï¼  
GUI ç‰ˆã® Docker-Desktop for Linux ã‚’æ¨ã•ã‚Œã‚‹ãŒï¼ŒCLI é‹ç”¨ãªã‚‰ Docker Engine ã ã‘ã§ååˆ†ï¼  
Desktop ã¯å•†ç”¨ã¨ã‹äººæ•°ã¨ã‹ã§åˆ¶é™ãŒã‚ã‚‹ã®ã§æ³¨æ„ï¼

https://docs.docker.com/engine/install/ubuntu/

docker ã‚³ãƒãƒ³ãƒ‰ã‚’ sudo ãªã—ã§æ‰“ã¦ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ï¼Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ Docker ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹ï¼

```bash
sudo groupadd docker
sudo gpasswd -a $USER docker
sudo systemctl restart docker
```

ã“ã®ã‚ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦å†ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ï¼

## NVIDIA-Docker-2 ã‚’å…¥ã‚Œã‚‹

<https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#setting-up-nvidia-container-toolkit>

ä¸Šè¨˜ã®ã‚µã‚¤ãƒˆã«å¾“ã£ã¦å…¥ã‚Œã‚‹ï¼

```bash
distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
      && curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      && curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
sudo apt-get update
sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ GPU ãŒè¦‹ãˆã‚‹ã‹ãƒ†ã‚¹ãƒˆã™ã‚‹ï¼

```bash
sudo docker run --rm --gpus all nvidia/cuda:11.0.3-base-ubuntu20.04 nvidia-smi
```

## æ³¨æ„

CUDA ã« PATH ã‚’é€šã—ã¦ã„ãªã„çŠ¶æ…‹ã§ï¼Œnvcc ã‚’æ‰“ã¤ã¨ï¼Œ`cuda-toolkit`ã‚’å…¥ã‚Œã‚ã¨è¨€ã‚ã‚Œã‚‹ãŒå…¥ã‚Œã¦ã¯ã„ã‘ãªã„ï¼
å…¥ã‚Œã‚‹ã¨ï¼Œæœ€æ–°ã® CUDA ã§ã‚ã‚‹ 11.7 ãŒå‰Šé™¤ã•ã‚Œã¦ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç›´å¾Œã«å…¥ã£ã¦ã„ãŸ 11.5 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ã‚‰ã‚Œã¦ã—ã¾ã†ï¼
